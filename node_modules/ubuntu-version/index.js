"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getUbuntuVersion = void 0;
const child_process_1 = require("child_process");
function isSystemError(e) {
    return 'errno' in e;
}
function command(exe, args) {
    return new Promise((resolve, reject) => {
        child_process_1.execFile(exe, args, { encoding: 'utf8', shell: false }, (error, stdout, stderr) => {
            if (error) {
                if (isSystemError(error) && error.code === 'ENOENT') {
                    resolve(null); // When lsb_release is not found
                    return;
                }
                reject(new Error(`Could not execute \`${exe} ${args.join(' ')}\`: ${error} (stderr=${stderr})`));
                return;
            }
            resolve(stdout);
        });
    });
}
async function getUbuntuVersion() {
    var _a, _b, _c;
    if (process.platform !== 'linux') {
        return null;
    }
    const stdout = await command('lsb_release', ['-a']);
    if (stdout === null) {
        return null;
    }
    const reDistributor = /^Distributor ID:\s*(.+)$/;
    const reDescription = /^Description:\s*(.+)$/;
    const reRelease = /^Release:\s*(.+)$/;
    const reCodename = /^Codename:\s*(.+)$/;
    let description = null;
    let release = null;
    let codename = null;
    for (const line of stdout.split('\n')) {
        const m = line.match(reDistributor);
        if (m !== null) {
            const distributor = m[1];
            if (distributor !== 'Ubuntu') {
                return null;
            }
        }
        const desc = (_a = line.match(reDescription)) === null || _a === void 0 ? void 0 : _a[1];
        if (desc) {
            description = desc;
        }
        const rel = (_b = line.match(reRelease)) === null || _b === void 0 ? void 0 : _b[1];
        if (rel) {
            release = rel;
        }
        const code = (_c = line.match(reCodename)) === null || _c === void 0 ? void 0 : _c[1];
        if (code) {
            codename = code;
        }
    }
    if (description === null || release === null || codename === null) {
        return null;
    }
    return { description, release, codename };
}
exports.getUbuntuVersion = getUbuntuVersion;
//# sourceMappingURL=index.js.map